<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Credencial</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #ddd;
    font-family: 'Roboto', Arial, sans-serif;
}

#viewport {
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

#credencial {
    position: relative;
    width: 2040px;
    height: 3325px;
    background: #fff;
    transform-origin: top center;
}

/* FOTO */
#capa-foto {
    position: absolute;
    top: 520px;
    left: 120px;
    width: 1600px;
    height: 855px;
    border: 5px solid orange;
    z-index: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}

#capa-foto img {
    height: 100%;
    width: auto;
    object-fit: contain;
}

/* FONDO */
#capa-fondo {
    position: absolute;
    inset: 0;
    border: 5px solid red;
    z-index: 2;
}

#capa-fondo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* QR */
#capa-qr {
    position: absolute;
    bottom: 320px;
    left: 120px;
    width: 864px;
    height: 850px;
    border: 5px solid green;
    z-index: 3;
    display: flex;
    flex-direction: column;
    align-items: center;
}

#capa-qr img {
    width: 500px;
    height: 500px;
    object-fit: contain;
    margin-top: 40px;
}

#qr-texto {
    margin-top: 40px;
    font-size: 40px;
    text-align: center;
}

/* TEXTO */
#capa-texto {
    position: absolute;
    bottom: 1300px;
    left: 0;
    width: 100%;
    height: 520px;
    padding: 40px 120px;
    box-sizing: border-box;
    border: 5px solid purple;
    z-index: 4;
    text-align: center;
}

#capa-texto div {
    font-size: 100px;
    font-weight: 700;
    margin-bottom: 25px;
}

/* LICENCIATURA */
#licenciatura {
    position: absolute;
    bottom: 310px;
    right: 180px;
    width: 800px;
    text-align: center;
    z-index: 5;
}

#licenciatura .titulo {
    font-size: 80px;
    color: red;
    font-weight: 700;
}

#licenciatura .campus {
    font-size: 60px;
    color: red;
    margin-bottom: 40px;
}

/* CUADROS INGRESO / EGRESO */
#fechas {
    display: flex;
    justify-content: center;
    gap: 40px;
}

.cuadro {
    width: 160px;
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 70px;
    font-weight: 700;
}

/* ESCALA */
@media print {
    #credencial {
        transform: scale(1) !important;
    }
}
</style>
</head>

<body>

<div id="viewport">
<div id="credencial">

    <div id="capa-foto">
        <img id="foto">
    </div>

    <div id="capa-fondo">
        <img id="fondo">
    </div>

    <div id="capa-qr">
        <img id="qr">
    </div>

    <div id="capa-texto">
        <div id="nombre"></div>
        <div id="id"></div>
        <div id="carrera"></div>
    </div>

    <div id="licenciatura">
        <div id="fechas">
            <div class="cuadro" id="ingreso"></div>
            <div class="cuadro" id="egreso"></div>
        </div>
    </div>

</div>
</div>

<script>
const BASE_WIDTH = 2040;
const BASE_HEIGHT = 3325;

function ajustarEscala() {
    const viewport = document.getElementById("viewport");
    const scale = Math.min(
        viewport.clientWidth / BASE_WIDTH,
        viewport.clientHeight / BASE_HEIGHT
    );
    document.getElementById("credencial").style.transform = `scale(${scale})`;
}

window.addEventListener("resize", ajustarEscala);
window.addEventListener("load", ajustarEscala);

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vR7VpRlusZqfiI-WB16JvLtLpX-kkCFZWiKgTMQzW35p_tfOGxY_tpQRW56XnAOdKIA_1F-4uSuX47P/pub?gid=970287024&single=true&output=csv";

const params = new URLSearchParams(window.location.search);
const matriculaBuscar = params.get("matricula");

function parseCSV(texto) {
    return texto.trim().split("\n")
        .map(f => f.split(",").map(v => v.replace(/\"/g, "").trim()));
}

async function cargarDatos() {
    const resp = await fetch(CSV_URL);
    const texto = await resp.text();
    const data = parseCSV(texto);

    const headers = data[0];
    const rows = data.slice(1);
    const fila = rows.find(r => r[headers.indexOf("ID9DIG")] === matriculaBuscar);
    if (!fila) return;

    const get = c => fila[headers.indexOf(c)];

    document.getElementById("foto").src = get("Foto");
    document.getElementById("fondo").src = get("Fondo");
    document.getElementById("qr").src = get("QR");

    document.getElementById("nombre").textContent = get("Nombre");
    document.getElementById("id").textContent = "ID: " + get("ID9DIG");
    document.getElementById("carrera").textContent = get("Carrera");

    document.getElementById("ingreso").textContent = get("AñoIngreso");
    document.getElementById("egreso").textContent = get("AñoEgreso");
}

cargarDatos();
</script>

</body>
</html>


